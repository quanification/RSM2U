<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Payment Successful</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main>
    <h1>ðŸŽ‰ Payment Confirmed!</h1>
    <p>Thank you! Your delivery request has been received and is now being processed.</p>
    <p>One of our representatives will reach out to you shortly for additional details. Please have a screenshot of your order prepared.</p>
    <p>We appreciate your business and look forward to delivering your order soon!</p>
    <a href="index.html"><button class="primary-button">Return to Home</button></a>
  </main>

  <!-- Hidden Formspree Form -->
  <form id="formspreeForm" action="https://formspree.io/f/xanjwyqv" method="POST" enctype="multipart/form-data" style="display: none;">
    <input type="hidden" name="email" />
    <input type="hidden" name="restaurant" />
    <input type="hidden" name="dropoff" />
    <input type="hidden" name="pickupTime" />
    <input type="hidden" name="orderTotal" />
    <input type="hidden" name="tip" />
    <input type="hidden" name="deliveryFee" />
    <input type="hidden" name="total" />
    <input type="file" name="screenshot" id="screenshotInput" />
    <button type="submit">Submit</button>
  </form>

  <script>
    const data = JSON.parse(localStorage.getItem("rsm2u_order"));
    const form = document.getElementById("formspreeForm");

    if (data) {
      form.email.value = data.email;
      form.restaurant.value = data.restaurant;
      form.dropoff.value = data.dropoff;
      form.pickupTime.value = data.pickupTime;
      form.orderTotal.value = data.orderTotal;
      form.tip.value = data.tip;
      form.deliveryFee.value = data.deliveryFee;
      form.total.value = data.total;

      // If you're storing a file as base64 in localStorage
      if (data.screenshotBase64) {
        const blob = fetch(data.screenshotBase64)
          .then(res => res.blob())
          .then(blob => {
            const file = new File([blob], "screenshot.png", { type: "image/png" });
            const dt = new DataTransfer();
            dt.items.add(file);
            document.getElementById("screenshotInput").files = dt.files;
            form.submit();
          });
      } else {
        form.submit(); // Submit without image if not present
      }
    }
  </script>
</body>
</html>
